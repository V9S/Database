---备份卡片
CREATE TABLE GAMS_CARD_bak1207 AS SELECT id ,YUJSMZL FROM GAMS_CARD;
CREATE TABLE GAMS_CARD_CL_bak1207 AS SELECT id ,YUJSMZL FROM GAMS_CARD_CL gcc ;
CREATE TABLE GAMS_CARD_FW_bak1207 AS SELECT id ,YUJSMZL FROM GAMS_CARD_FW gcf ;
CREATE TABLE GAMS_CARD_GZW_bak1207 AS SELECT id ,YUJSMZL FROM GAMS_CARD_GZW gcg ;
CREATE TABLE GAMS_CARD_JJYJZJ_bak1207 AS SELECT id ,YUJSMZL FROM GAMS_CARD_JJYJZJ gcj ;
CREATE TABLE GAMS_CARD_TD_bak1207 AS SELECT id ,YUJSMZL FROM GAMS_CARD_TD gct ;
CREATE TABLE GAMS_CARD_TSDA_bak1207 AS SELECT id ,YUJSMZL FROM GAMS_CARD_TSDA gct ;
CREATE TABLE GAMS_CARD_TYSB_bak1207 AS SELECT id ,YUJSMZL FROM GAMS_CARD_TYSB gct ;
CREATE TABLE GAMS_CARD_TZDZW_bak1207 AS SELECT id ,YUJSMZL FROM GAMS_CARD_TZDZW gct ;
CREATE TABLE GAMS_CARD_WWHCLP_bak1207 AS SELECT id ,YUJSMZL FROM GAMS_CARD_WWHCLP gcw ;
CREATE TABLE GAMS_CARD_WXZC_bak1207 AS SELECT id ,YUJSMZL FROM GAMS_CARD_WXZC gcw ;
CREATE TABLE GAMS_CARD_ZYSB_bak1207 AS SELECT id ,YUJSMZL FROM GAMS_CARD_ZYSB gcz ;

--1、导入文件

CREATE TABLE GAMS_CARD_temp AS SELECT id ,YUJSMZL FROM GAMS_CARD;
CREATE TABLE GAMS_CARD_CL_temp AS SELECT id ,YUJSMZL FROM GAMS_CARD_CL gcc ;
CREATE TABLE GAMS_CARD_FW_temp AS SELECT id ,YUJSMZL FROM GAMS_CARD_FW gcf ;
CREATE TABLE GAMS_CARD_GZW_temp AS SELECT id ,YUJSMZL FROM GAMS_CARD_GZW gcg ;
CREATE TABLE GAMS_CARD_JJYJZJ_temp AS SELECT id ,YUJSMZL FROM GAMS_CARD_JJYJZJ gcj ;
CREATE TABLE GAMS_CARD_TD_temp AS SELECT id ,YUJSMZL FROM GAMS_CARD_TD gct ;
CREATE TABLE GAMS_CARD_TSDA_temp AS SELECT id ,YUJSMZL FROM GAMS_CARD_TSDA gct ;
CREATE TABLE GAMS_CARD_TYSB_temp AS SELECT id ,YUJSMZL FROM GAMS_CARD_TYSB gct ;
CREATE TABLE GAMS_CARD_TZDZW_temp AS SELECT id ,YUJSMZL FROM GAMS_CARD_TZDZW gct ;
CREATE TABLE GAMS_CARD_WWHCLP_temp AS SELECT id ,YUJSMZL FROM GAMS_CARD_WWHCLP gcw ;
CREATE TABLE GAMS_CARD_WXZC_temp AS SELECT id ,YUJSMZL FROM GAMS_CARD_WXZC gcw ;
CREATE TABLE GAMS_CARD_ZYSB_temp AS SELECT id ,YUJSMZL FROM GAMS_CARD_ZYSB gcz ;

--2、更新卡片折旧年限
update GAMS_CARD  a set a.YUJSMZL = (SELECT b.YUJSMZL FROM GAMS_CARD_TEMP b WHERE a.ID= b.ID group by b.YUJSMZL);
update GAMS_CARD_CL  a set a.YUJSMZL = (SELECT b.YUJSMZL FROM GAMS_CARD_CL_TEMP b WHERE a.ID= b.ID group by b.YUJSMZL);
update GAMS_CARD_FW  a set a.YUJSMZL = (SELECT b.YUJSMZL FROM GAMS_CARD_FW_TEMP b WHERE a.ID= b.ID group by b.YUJSMZL);
update GAMS_CARD_GZW  a set a.YUJSMZL = (SELECT b.YUJSMZL FROM GAMS_CARD_GZW_TEMP b WHERE a.ID= b.ID group by b.YUJSMZL);
update GAMS_CARD_JJYJZJ  a set a.YUJSMZL = (SELECT b.YUJSMZL FROM GAMS_CARD_JJYJZJ_TEMP b WHERE a.ID= b.ID group by b.YUJSMZL);
update GAMS_CARD_TD  a set a.YUJSMZL = (SELECT b.YUJSMZL FROM GAMS_CARD_TD_TEMP b WHERE a.ID= b.ID group by b.YUJSMZL);
update GAMS_CARD_TSDA  a set a.YUJSMZL = (SELECT b.YUJSMZL FROM GAMS_CARD_TSDA_TEMP b WHERE a.ID= b.ID group by b.YUJSMZL);
update GAMS_CARD_TYSB  a set a.YUJSMZL = (SELECT b.YUJSMZL FROM GAMS_CARD_TYSB_TEMP b WHERE a.ID= b.ID group by b.YUJSMZL);
update GAMS_CARD_TZDZW a set a.YUJSMZL = (SELECT b.YUJSMZL FROM GAMS_CARD_TZDZW_TEMP b WHERE a.ID= b.ID group by b.YUJSMZL);
update GAMS_CARD_WWHCLP  a set a.YUJSMZL = (SELECT b.YUJSMZL FROM GAMS_CARD_WWHCLP_TEMP b WHERE a.ID= b.ID group by b.YUJSMZL);
update GAMS_CARD_WXZC  a set a.YUJSMZL = (SELECT b.YUJSMZL FROM GAMS_CARD_WXZC_TEMP b WHERE a.ID= b.ID group by b.YUJSMZL);
update GAMS_CARD_ZYSB  a set a.YUJSMZL = (SELECT b.YUJSMZL FROM GAMS_CARD_ZYSB_TEMP b WHERE a.ID= b.ID group by b.YUJSMZL);
COMMIT;
--3、删除导入的表
drop table GAMS_CARD_temp ;
drop table GAMS_CARD_CL_temp ;
drop table GAMS_CARD_FW_temp ;
drop table GAMS_CARD_GZW_temp ;
drop table GAMS_CARD_JJYJZJ_temp ;
drop table GAMS_CARD_TD_temp ;
drop table GAMS_CARD_TSDA_temp ;
drop table GAMS_CARD_TYSB_temp ;
drop table GAMS_CARD_TZDZW_temp;
drop table GAMS_CARD_WWHCLP_temp ;
drop table GAMS_CARD_WXZC_temp ;
drop table GAMS_CARD_ZYSB_temp ;
--备份表用户相关表
CREATE TABLE NP_USER_bak1207 AS SELECT * FROM  NP_USER;
CREATE TABLE NP_PASSWORD_bak1207 AS SELECT * FROM  NP_PASSWORD;
CREATE TABLE AUTHZ_IDENTITY_bak1207 AS SELECT * FROM  AUTHZ_IDENTITY;
CREATE TABLE GAMS_USER_ORG_REL_bak1207 AS SELECT * FROM  GAMS_USER_ORG_REL;
CREATE TABLE AUTHZ_USER_IDENTITY_bak1207 AS SELECT * FROM  AUTHZ_USER_IDENTITY;
CREATE TABLE AUTHZ_IDENTITY_ROLE_bak1207 AS SELECT * FROM  AUTHZ_IDENTITY_ROLE;
CREATE TABLE AUTHZ_RULE_AUTHORIZATION1207 AS SELECT * FROM  AUTHZ_RULE_AUTHORIZATION;
CREATE TABLE GAMS_JC_PERSONNEL_bak1207 AS SELECT * FROM  GAMS_JC_PERSONNEL;

-----------生成用户身份--------------
CREATE TABLE NP_USER_temp AS SELECT * FROM  NP_USER;
CREATE TABLE NP_PASSWORD_temp AS SELECT * FROM  NP_PASSWORD;
CREATE TABLE AUTHZ_IDENTITY_temp AS SELECT * FROM  AUTHZ_IDENTITY;
CREATE TABLE GAMS_USER_ORG_REL_temp AS SELECT * FROM  GAMS_USER_ORG_REL;
CREATE TABLE AUTHZ_USER_IDENTITY_temp AS SELECT * FROM  AUTHZ_USER_IDENTITY;
CREATE TABLE AUTHZ_IDENTITY_ROLE_temp AS SELECT * FROM  AUTHZ_IDENTITY_ROLE;
CREATE TABLE AUTHZ_RULE_AUTHORIZATION_temp AS SELECT * FROM  AUTHZ_RULE_AUTHORIZATION;
CREATE TABLE GAMS_JC_PERSONNEL_temp AS SELECT * FROM  GAMS_JC_PERSONNEL;


INSERT INTO NP_USER a SELECT * FROM NP_USER_temp b where b.id not in (select c.id  from np_user c left join np_user_temp d on c.id = d.id);
INSERT INTO NP_PASSWORD a SELECT * FROM NP_PASSWORD_temp b where b.id not in (select c.id  from NP_PASSWORD c left join NP_PASSWORD_temp d on c.USERNAME = d.USERNAME);
INSERT INTO AUTHZ_IDENTITY a SELECT * FROM AUTHZ_IDENTITY_temp b where b.id not in (select c.id  from AUTHZ_IDENTITY c left join AUTHZ_IDENTITY_temp d on c.NAME = d.NAME);
INSERT INTO GAMS_USER_ORG_REL a SELECT * FROM GAMS_USER_ORG_REL_temp b where b.id not in (select c.id  from GAMS_USER_ORG_REL c left join GAMS_USER_ORG_REL_temp d on c.USERID = d.USERID);
INSERT INTO AUTHZ_USER_IDENTITY a SELECT * FROM AUTHZ_USER_IDENTITY_temp b where b.id not in (select c.id  from AUTHZ_USER_IDENTITY c left join AUTHZ_USER_IDENTITY_temp d on c.USER_ID = d.USER_ID);
INSERT INTO AUTHZ_IDENTITY_ROLE a SELECT * FROM AUTHZ_IDENTITY_ROLE_temp b where b.IDENTITY_ID not in (select c.IDENTITY_ID  from AUTHZ_IDENTITY_ROLE c left join AUTHZ_IDENTITY_ROLE_temp d on c.IDENTITY_ID = d.IDENTITY_ID);
INSERT INTO AUTHZ_RULE_AUTHORIZATION a SELECT * FROM AUTHZ_RULE_AUTHORIZATION_temp b where b.grantee_id not in (select c.grantee_id  from AUTHZ_RULE_AUTHORIZATION c left join AUTHZ_RULE_AUTHORIZATION_temp d on c.grantee_id = d.grantee_id);
update GAMS_JC_PERSONNEL  a set a.USERID = (SELECT b.USERID FROM GAMS_JC_PERSONNEL_TEMP b WHERE a.ID= b.ID ) WHERE a.USERID IS null;

alter table NP_USER modify (avatar nvarchar2(20));

alter table NP_USER modify (avatar blob);

alter table NP_USER modify (avatar LONG RAW);

alter table NP_USER modify (avatar blob);

alter index index_name rebuild;

delete from NP_USER where name in ('sadmin','audmin','qadmin') and id not in (select id from np_user_bak1207);



drop table NP_USER_temp ;
drop table NP_PASSWORD_temp ;
drop table AUTHZ_IDENTITY_temp ;
drop table GAMS_USER_ORG_REL_temp ;
drop table AUTHZ_USER_IDENTITY_temp ;
drop table AUTHZ_IDENTITY_ROLE_temp ;
drop table AUTHZ_RULE_AUTHORIZATION_temp ;
drop table GAMS_JC_PERSONNEL_temp ;

------------------------------ 
SELECT * FROM GAMS_JC_PERSONNEL gjp WHERE name = '黄伟';

SELECT * FROM  NP_USER nu WHERE nu.NICKNAME = '黄伟';

SELECT * FROM NP_USER nu WHERE nu.TELEPHONE = '13844627828';

SELECT * FROM GAMS_JC_PERSONNEL gjp WHERE name = '黄伟';

--黄伟人员关联修改
UPDATE GAMS_JC_PERSONNEL SET USERID = (SELECT USERID FROM GAMS_JC_PERSONNEL gjp WHERE id = '757804E20000036159930B1099D71E26') WHERE id = 'ABCEA49DBB6D451BA9BD9CAC9A48E498';

UPDATE GAMS_JC_PERSONNEL SET USERID = '5D65316ECE694EF2B9E06ECABEDBA812' WHERE id = '757804E20000036159930B1099D71E26';

UPDATE GAMS_JC_PERSONNEL SET USERID = (SELECT USERID FROM GAMS_JC_PERSONNEL_BAK1207 gjp WHERE id = 'ABCEA49DBB6D451BA9BD9CAC9A48E498') WHERE id = '757804E20000036159930B1099D71E26';

SELECT * FROM GAMS_JC_PERSONNEL gjp WHERE name = '李孟瑜';
SELECT * FROM GAMS_JC_PERSONNEL_BAK1207 gjp WHERE name = '李孟瑜';
-----李孟瑜
UPDATE GAMS_JC_PERSONNEL SET USERID = (SELECT USERID FROM GAMS_JC_PERSONNEL gjp WHERE id = '757804E200000381D95FCF6C3A117E57') WHERE id = 'F44E2BEFD60F4868A1AFC0DC74138A3F';

UPDATE GAMS_JC_PERSONNEL SET USERID = '810F5324D7A9439FB9B903673FD07F33' WHERE id = '757804E20000036159930B1099D71E26';

SELECT * FROM GAMS_INSPECTIONENTRY gi ;



SELECT * FROM AUTHZ_IDENTITY_ROLE aui WHERE ROLE_ID = '4AF65827B67C4616B0A5D2C6A1DF8FC9';

SELECT * FROM AUTHZ_ROLE ar WHERE id = '4AF65827B67C4616B0A5D2C6A1DF8FC9';



drop table NP_USER_temp ;
drop table NP_PASSWORD_temp ;
drop table AUTHZ_IDENTITY_temp ;
drop table GAMS_USER_ORG_REL_temp ;
drop table AUTHZ_USER_IDENTITY_temp ;
drop table AUTHZ_IDENTITY_ROLE_temp ;
drop table AUTHZ_RULE_AUTHORIZATION_temp ;
drop table GAMS_JC_PERSONNEL_temp ;




SELECT * FROM AUTHZ_IDENTITY_ROLE gba ;

SELECT *FROM AUTHZ_IDENTITY WHERE TITLE LIKE '%校级资产管理员%';

SELECT * FROM AUTHZ_RULE_AUTHORIZATION;

SELECT USERID FROM GAMS_JC_PERSONNEL air GROUP BY USERID HAVING (USERID) > 2;


SELECT 'drop table '||table_name||' cascade constraints;' FROM USER_TABLES;

SELECT * FROM AUTHZ_OBJECT_AUTHORIZATION aoa ;

SELECT * FROM AUTHZ_OBJRULE_AUTHORIZATION aoa ;

SELECT NAME FROM NP_USER nu GROUP BY NAME HAVING COUNT(NAME) >= 2;

SELECT * FROM NP_USER WHERE NAME = 'qadmin';

SELECT * FROM NP_USER nu WHERE nu.NAME = '00080102';

SELECT * FROM GAMS_JC_PERSONNEL gjp WHERE code = '00080102'; 

SELECT * FROM GAMS_JC_DEPARTMENT gjd WHERE id = (SELECT gjp.DEPARTMENT from GAMS_JC_PERSONNEL gjp WHERE code = '00080102'); 

SELECT * FROM AUTHZ_IDENTITY ai ;

SELECT * FROM authz_rule_authorization;

UPDATE GAMS_BILL_ANNEX SET SAVESTATE = 2 , MODULENAME = 'gams2.biz.attachmentgroup';

SELECT * FROM GAMS_JC_PERSONNEL WHERE NAME = '黄伟';
5D65316ECE694EF2B9E06ECABEDBA812

810f5324-d7a9-439f-b9b9-03673fd07f33

UPDATE GAMS_JC_PERSONNEL SET USERID = '810F5324D7A9439FB9B903673FD07F33' WHERE id = '757804E20000036159930B1099D71E26';


UPDATE GAMS_JC_PERSONNEL SET USERID = '5D65316ECE694EF2B9E06ECABEDBA812' WHERE id = 'ABCEA49DBB6D451BA9BD9CAC9A48E498';

select * from gams_jc_cwparam WHERE title LIKE '%退库%';

SELECT * FROM gams_jc_assetclass_ind WHERE id = '3AD9F944A00008C142A6C9CD200DB469';

DELETE FROM GAMS_JC_PERSONNEL gjp WHERE gjp.CODE = '190101481';


select * from np_user where name = '19010169';
select * from np_user where name = '220061027';

select * from np_user where name = '19010169' or name = '220061027';

select * from  AUTHZ_USER_IDENTITY  where user_id = '757804E200000381D95FCF6C3A117E57';
select * from  AUTHZ_USER_IDENTITY  where user_id = '3EB5FEAE8C7C9B7A24375E1E8C192C06';

select * from  AUTHZ_USER_IDENTITY  where user_id = '757804E200000381D95FCF6C3A117E57' or user_id = '3EB5FEAE8C7C9B7A24375E1E8C192C06';

select * from AUTHZ_IDENTITY where id = '7524EC57248B4A76BC40B6DF6AC7A238';
select * from AUTHZ_IDENTITY where id = '6C5B19B7FD734A06B05701D7A64AAC48';

select * from AUTHZ_IDENTITY where id = '7524EC57248B4A76BC40B6DF6AC7A238' or id = '6C5B19B7FD734A06B05701D7A64AAC48';

select * from AUTHZ_IDENTITY where id = '43EEE73C2AD342ADA277CA31A0A9F1FF';
select * from AUTHZ_IDENTITY where id = '668E1827AA86414F92C39D62F437321E';

select * from AUTHZ_IDENTITY where id = '43EEE73C2AD342ADA277CA31A0A9F1FF' or id = '668E1827AA86414F92C39D62F437321E';

select * from  AUTHZ_IDENTITY_ROLE where identity_id = '7524EC57248B4A76BC40B6DF6AC7A238';
select * from  AUTHZ_IDENTITY_ROLE where identity_id = '6C5B19B7FD734A06B05701D7A64AAC48';

select * from  AUTHZ_IDENTITY_ROLE where identity_id = '7524EC57248B4A76BC40B6DF6AC7A238' or identity_id = '6C5B19B7FD734A06B05701D7A64AAC48';

select * from  AUTHZ_IDENTITY_ROLE where identity_id = '668E1827AA86414F92C39D62F437321E';
select * from  AUTHZ_IDENTITY_ROLE where identity_id = '43EEE73C2AD342ADA277CA31A0A9F1FF';

select * from  AUTHZ_IDENTITY_ROLE where identity_id = '43EEE73C2AD342ADA277CA31A0A9F1FF' or identity_id = '668E1827AA86414F92C39D62F437321E';

select * from  AUTHZ_RULE_AUTHORIZATION a where a.grantee_id = '7524EC57248B4A76BC40B6DF6AC7A238' ;
select * from  AUTHZ_RULE_AUTHORIZATION a where a.grantee_id = '6C5B19B7FD734A06B05701D7A64AAC48' ;

select * from  AUTHZ_RULE_AUTHORIZATION a where a.grantee_id = '7524EC57248B4A76BC40B6DF6AC7A238' or a.grantee_id = '6C5B19B7FD734A06B05701D7A64AAC48' for update;
 
select * from  AUTHZ_RULE_AUTHORIZATION a where a.grantee_id = '668E1827AA86414F92C39D62F437321E' ;
select * from  AUTHZ_RULE_AUTHORIZATION a where a.grantee_id = '43EEE73C2AD342ADA277CA31A0A9F1FF' ;

select * from  AUTHZ_RULE_AUTHORIZATION a where a.grantee_id = '668E1827AA86414F92C39D62F437321E' or a.grantee_id = '43EEE73C2AD342ADA277CA31A0A9F1FF';

create table AUTHZ_USER_IDENTITY1208 as select * from  AUTHZ_USER_IDENTITY
select * from  NP_USER ;
select * from  NP_PASSWORD  ;
select * from  AUTHZ_IDENTITY ;
---select * from  GAMS_USER_ORG_REL where userid = '3EB5FEAE8C7C9B7A24375E1E8C192C06' for update ;
select * from  AUTHZ_USER_IDENTITY  where user_id = '3EB5FEAE8C7C9B7A24375E1E8C192C06'for update;
select * from AUTHZ_IDENTITY where id in ('7524EC57248B4A76BC40B6DF6AC7A238','43EEE73C2AD342ADA277CA31A0A9F1FF','1E4F20AAED71401CA57EF7BC953FC6B7')
select * from  AUTHZ_IDENTITY_ROLE  where identity_id = '7524EC57248B4A76BC40B6DF6AC7A238';
select * from  AUTHZ_RULE_AUTHORIZATION a where a.grantee_id = '7524EC57248B4A76BC40B6DF6AC7A238' or a.grantee_id = '6C5B19B7FD734A06B05701D7A64AAC48';
select * from  GAMS_JC_PERSONNEL  ;
userid = '3EB5FEAE8C7C9B7A24375E1E8C192C06'

SELECT * FROM NP_USER nu WHERE nu.NAME in ('220061027','19010169');

select * from AUTHZ_IDENTITY where title = '身份-校级资产管理员';

SELECT * FROM AUTHZ_IDENTITY_ROLE WHERE IDENTITY_ID = '7524EC57248B4A76BC40B6DF6AC7A238';

SELECT * FROM AUTHZ_IDENTITY_ROLE WHERE IDENTITY_ID = '668E1827AA86414F92C39D62F437321E';

SELECT * FROM AUTHZ_IDENTITY where id = '6C5B19B7FD734A06B05701D7A64AAC48';
