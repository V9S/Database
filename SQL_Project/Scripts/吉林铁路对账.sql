--解决期初金额问题

CREATE TABLE b as
SELECT
		CHANGE.*
	FROM
		GAMS_CARD_CHANGE  CHANGE
		LEFT JOIN GAMS_JC_ASSETSORT_GB gjag ON CHANGE.SORTGB = gjag.ID 
	WHERE
		change.sortgb = '3DCA958F0000002178673E76D0CE4984'
		AND change.jizrq < to_date('2016-01-01 00:00:00','yyyy-mm-dd HH24:mi:ss')
		AND CHANGE.ORG = '456E9EA9E0000001E75604D5761203C3'
		AND CHANGE.CARDOBJECTID NOT IN (
SELECT
	c.* 
FROM
	gams_card  c,
	(
	SELECT
		c2.objectid AS objectid,
		max(c2.yewxlh) AS yewxlh
	FROM
		gams_card  c2
	WHERE
		 c2.jizrq <= to_date('2016-01-01 00:00:00','yyyy-mm-dd HH24:mi:ss')
		AND c2.orgunit = '456E9EA9E0000001E75604D5761203C3'
	GROUP BY
		c2.objectid)  c3
WHERE
	c.sortgb = '3DCA958F0000002178673E76D0CE4984'
	AND c.yewxlh = c3.yewxlh
	AND c.objectid = c3.objectid
	AND c.auditstate = 2
	AND c.cardstate LIKE '0%'
	AND c.orgunit = '456E9EA9E0000001E75604D5761203C3'
	AND c.id NOT IN (SELECT
		CHANGE.CARDID 
	FROM
		GAMS_CARD_CHANGE  CHANGE
		LEFT JOIN GAMS_JC_ASSETSORT_GB gjag ON CHANGE.SORTGB = gjag.ID 
	WHERE
		change.sortgb = '3DCA958F0000002178673E76D0CE4984'
		AND change.jizrq < to_date('2016-01-01 00:00:00','yyyy-mm-dd HH24:mi:ss')
		AND CHANGE.ORG = '456E9EA9E0000001E75604D5761203C3');

SELECT * FROM GAMS_CARD_CHANGE gcc WHERE gcc.CARDOBJECTID = '7597265B000000C17CF933B165CE7FFF';



SELECT * FROM GAMS_CARD gc WHERE gc.BILLCODE ='20152031';


SELECT * FROM GAMS_CARD gc WHERE gc.ID IN (SELECT cardid FROM a)
		
		SELECT sum(jiaz_z),sum(jiaz_j) FROM GAMS_CARD_CHANGE gcc WHERE gcc.jizrq < to_date('2016-01-01 00:00:00','yyyy-mm-dd HH24:mi:ss') AND gcc.SORTGB IS NULL AND gcc.ORG = '6E35BC1F80000001F6D62BD49F8EC9CC';
	
		SELECT * FROM GAMS_CARD gc WHERE id = '6ED4F85F200000A10F6C586116E53AEC';
	
		SELECT BIZTYPE FROM GAMS_CARD_CHANGE gcc WHERE gcc.SORTGB IS NULL GROUP BY BIZTYPE ;
		
		UPDATE GAMS_CARD_CHANGE a  SET sortgb = (SELECT SORTGB FROM gams_card c WHERE c.id =a.CARDID ) WHERE a.SORTGB IS NULL;
		
		CREATE TABLE gams_card_change_temp AS SELECT * FROM GAMS_CARD_CHANGE;
		
		DROP TABLE GAMS_CARD_CHANGE;
		
		CREATE TABLE GAMS_CARD_CHANGE AS SELECT * FROM gams_card_change_temp;
		
	SELECT * FROM GAMS_JC_ASSETSORT_GB WHERE id = '3DCA958F0000002178673E76D0CE4984';
	SELECT * FROM ORG o ;

SELECT
	c.ID 
FROM
	gams_card  c,
	(
	SELECT
		c2.objectid AS objectid,
		max(c2.yewxlh) AS yewxlh
	FROM
		gams_card  c2
	WHERE
		 c2.jizrq <= to_date('2022-01-01 00:00:00','yyyy-mm-dd HH24:mi:ss')
		AND c2.orgunit = '456E9EA9E0000001E75604D5761203C3'
	GROUP BY
		c2.objectid)  c3
WHERE
	c.sortgb = '3DCA958F0000002178673E76D0CE4984'
	AND c.yewxlh = c3.yewxlh
	AND c.objectid = c3.objectid
	AND c.auditstate = 2
	AND c.cardstate LIKE '0%'
	AND c.orgunit = '456E9EA9E0000001E75604D5761203C3'

--处理
 DELETE
FROM
	GAMS_CARD_CHANGE gcc
WHERE
	gcc.CARDID = (
	SELECT
		id
	FROM
		GAMS_CARD gc
	WHERE
		gc.BILLCODE = 'TY2021000021');

DELETE FROM GAMS_CARD_TRACE gct WHERE gct.CARDID = (SELECT id FROM GAMS_CARD gc WHERE gc.BILLCODE = 'TY2021000021');

DELETE FROM GAMS_CARD_LOCK gcl WHERE gcl.CARDOBJECTID = (SELECT OBJECTID FROM GAMS_CARD gc WHERE gc.BILLCODE = 'TY2021000021');

DELETE FROM GAMS_CARD_USEINFO gcu WHERE gcu.CARDOBJECTID = (SELECT OBJECTID FROM GAMS_CARD gc WHERE gc.BILLCODE = 'TY2021000021');

DELETE FROM GAMS_ANNEX_SECRETKEY WHERE ANNEXID IN (SELECT id FROM GAMS_BILL_ANNEX gba WHERE gba.BILLID = (SELECT OBJECTID FROM GAMS_CARD gc WHERE gc.BILLCODE = 'TY2021000021'));

DELETE FROM GAMS_BILL_ANNEX gba WHERE gba.BILLID = (SELECT OBJECTID FROM GAMS_CARD gc WHERE gc.BILLCODE = 'TY2021000021');

DELETE FROM GAMS_CARD_INVOICE gci WHERE gci.MASTER_ID = (SELECT id FROM GAMS_CARD gc WHERE gc.BILLCODE = 'TY2021000021');

DELETE FROM GAMS_CARD_ZYSB gct WHERE gct.BILLCODE = 'TY2021000021';
DELETE  FROM GAMS_CARD gc WHERE gc.BILLCODE = 'TY2021000021';

SELECT * FROM GAMS_CARD_CHANGE gcc WHERE gcc.BIZTYPE ='com.jiuqi.np.gams2.core.gams_card_wxzc_rj';
SELECT * FROM GAMS_CARD gcc WHERE gcc.ID ='7597265B000000C17CF933B165CE7FFF';

SELECT BIZTYPE,count(1) FROM GAMS_CARD_CHANGE gcc GROUP BY  gcc.BIZTYPE ;
SELECT CAIWJZRQ FROM GAMS_CARD gc WHERE gc.BILLCODE ='20152031';

INSERT INTO GAMS_CARD_CHANGE (ID,CARDID,CARDOBJECTID,BIZID,BIZTYPE,BIZCODE,BIZTIME,ORG,JIZRQ,JIZQJ,CAIWJZRQ,CAOZSJ,ZICFL,HANGYFL,HANGYFLNEW,HANGYDL,SORTGB,SHIYBM,SHIYZK,SHIYR,QUDFS,BIANZQK,YONGTFL,CHANQXS,QUANSXZ,JIAZLX,CHUZXS,CUNFDD,JIAOYSYFX,JIAZ,JIAZ_Z,JIAZ_J,SHUL,SHUL_Z,SHUL_J,MIANJ,MIANJ_Z,MIANJ_J,XIAOJBGYF,XIAOJBGYF_Z,XIAOJBGYF_J,XIAOJQZBGSYF,XIAOJQZBGSYF_Z,XIAOJQZBGSYF_J,XIAOJYWYF,XIAOJYWYF_Z,XIAOJYWYF_J,XIAOJIQTYF,XIAOJIQTYF_Z,XIAOJIQTYF_J,GRADE,NATURE,ZICFL_D,SORTGB_D,HANGYFL_D,HANGYDL_D,SHIYBM_D,SHIYR_D,CUNFDD_D,JIAOYSYFX_D,SHIYZK_D,QUDFS_D,BIANZQK_D,YONGTFL_D,CHANQXS_D,QUANSXZ_D,JIAZLX_D,JINGFKM_D,BIANDCZSXH,ZICFLCODE,FINALBILLID) VALUES
	 ('CC94570444FD4D288F4652B9721904C6',
'7597265CC00000C159CD03E1B525A355',
'7597265CC00000C159CD03E1B525A355',
'7597265CC00000C159CD03E1B525A355',
'com.jiuqi.np.gams2.core.gams_card_wxzc_rj',
'RJ20201105000677X',
TIMESTAMP'2020-11-06 20:22:00.203',
'456E9EA9E0000001E75604D5761203C3',
TIMESTAMP'2015-12-01 00:00:00',
'201512',
TIMESTAMP'2015-12-01 00:00:00',
TIMESTAMP'2020-11-13 16:40:05.623',
'66C8BC4D00000001C72D9DB1D2BECDBE',
'66C8BC4D00000001C72D9DB1D2BECDBE',
NULL,
'3AF8EAD040000001C2BD309451B5B7AC',
'3DCA958F0000002178673E76D0CE4984',
'75775F38E00000A1DFDD5F0446D45EC6',
'5E5B480EC000000128A33A05401E5748',
'757804E1400002C16AB6C86C65C1F9A1',
'36B91A2620000001112E65D5B88F4774',
NULL,
NULL,
NULL,
NULL,
'36B908C8A00000016F9E6175B4B985DA',
NULL,
NULL,
'3AB70BFC40000021A9A6A1A1175DC935',
92000,
92000,
NULL,
1,
1,
NULL,
0,
0,
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
'STRICT',
'account_entry',
'66C8BC4D00000001C72D9DB1D2BECDBE',
'3DCA958F0000002178673E76D0CE4984',
'66C8BC4D00000001C72D9DB1D2BECDBE',
'3AF8EAD040000001C2BD309451B5B7AC',
'75775F38E00000A1DFDD5F0446D45EC6',
'757804E1400002C16AB6C86C65C1F9A1',
NULL,
'3AB70BFC40000021A9A6A1A1175DC935',
NULL,
'36B91A2620000001112E65D5B88F4774',
NULL,
NULL,
NULL,
NULL,
'36B908C8A00000016F9E6175B4B985DA',
NULL,
1,
'6050633',
NULL);


INSERT INTO GAMS_CARD_CHANGE (ID,CARDID,CARDOBJECTID,BIZID,BIZTYPE,BIZCODE,BIZTIME,ORG,JIZRQ,JIZQJ,CAIWJZRQ,CAOZSJ,ZICFL,HANGYFL,HANGYFLNEW,HANGYDL,SORTGB,SHIYBM,SHIYZK,SHIYR,QUDFS,BIANZQK,YONGTFL,CHANQXS,QUANSXZ,JIAZLX,CHUZXS,CUNFDD,JIAOYSYFX,JIAZ,JIAZ_Z,JIAZ_J,SHUL,SHUL_Z,SHUL_J,MIANJ,MIANJ_Z,MIANJ_J,XIAOJBGYF,XIAOJBGYF_Z,XIAOJBGYF_J,XIAOJQZBGSYF,XIAOJQZBGSYF_Z,XIAOJQZBGSYF_J,XIAOJYWYF,XIAOJYWYF_Z,XIAOJYWYF_J,XIAOJIQTYF,XIAOJIQTYF_Z,XIAOJIQTYF_J,GRADE,NATURE,ZICFL_D,SORTGB_D,HANGYFL_D,HANGYDL_D,SHIYBM_D,SHIYR_D,CUNFDD_D,JIAOYSYFX_D,SHIYZK_D,QUDFS_D,BIANZQK_D,YONGTFL_D,CHANQXS_D,QUANSXZ_D,JIAZLX_D,JINGFKM_D,BIANDCZSXH,ZICFLCODE,FINALBILLID) VALUES
	 ('8CDE208F9D5249B19AB285BFA1144290',
'7597265B000000C17CF933B165CE7FFF',
'7597265B000000C17CF933B165CE7FFF',
'7597265B000000C17CF933B165CE7FFF',
'com.jiuqi.np.gams2.core.gams_card_wxzc_rj',
'RJ20201105000677X',
TIMESTAMP'2020-11-06 20:22:00.203',
'456E9EA9E0000001E75604D5761203C3',
TIMESTAMP'2015-07-17 00:00:00',
'201507',
TIMESTAMP'2015-07-17 00:00:00',
TIMESTAMP'2020-11-13 16:40:05.623',
'66C8BC4D00000001C72D9DB1D2BECDBE',
'66C8BC4D00000001C72D9DB1D2BECDBE',
NULL,
'3AF8EAD040000001C2BD309451B5B7AC',
'3DCA958F0000002178673E76D0CE4984',
'75775F38E00000A1DFDD5F0446D45EC6',
'5E5B480EC000000128A33A05401E5748',
'757804E1400002C16AB6C86C65C1F9A1',
'36B91A2620000001112E65D5B88F4774',
NULL,
NULL,
NULL,
NULL,
'36B908C8A00000016F9E6175B4B985DA',
NULL,
NULL,
'3AB70BFC40000021A9A6A1A1175DC935',
29000,
29000,
NULL,
1,
1,
NULL,
0,
0,
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
NULL,
'STRICT',
'account_entry',
'66C8BC4D00000001C72D9DB1D2BECDBE',
'3DCA958F0000002178673E76D0CE4984',
'66C8BC4D00000001C72D9DB1D2BECDBE',
'3AF8EAD040000001C2BD309451B5B7AC',
'75775F38E00000A1DFDD5F0446D45EC6',
'757804E1400002C16AB6C86C65C1F9A1',
NULL,
'3AB70BFC40000021A9A6A1A1175DC935',
NULL,
'36B91A2620000001112E65D5B88F4774',
NULL,
NULL,
NULL,
NULL,
'36B908C8A00000016F9E6175B4B985DA',
NULL,
1,
'6050633',
NULL);
18000
SELECT *FROM GAMS_CARD gc WHERE gc.ID = '7597265B000000C17CF933B165CE7FFF';

SELECT *FROM GAMS_CARD_CHANGE gcc WHERE gcc.ID = '8CDE208F9D5249B19AB285BFA1144290';

SELECT * FROM GAMS_CARD gc ;